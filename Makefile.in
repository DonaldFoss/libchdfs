LIBHADOP_DIR = ..
GTEST_DIR = /usr/local/src/gtest-1.6.0

CXX = g++
CPPFLAGS += 
CXXFLAGS += -g -Wall -Wextra
CPPTESTFLAGS += -I${GTEST_DIR}/include -pthread

LTLIBRARIES = libhadoop.so
HEADERS = src/conf/Configuration.h hadoop.h
SOURCES = src/conf/Configuration.cc 
MAKEFILE_CONFS = configure config.status config.log autom4te.cache/ Makefile
TESTS = test/conf/ConfigurationTest.cc

all: $(LTLIBRARIES)

$(LTLIBRARIES): $(SOURCES) 
	$(CXX) -shared -o $(LTLIBRARIES) $(HEADERS) $(SOURCES)

clean: clean-config
	rm -rf $(LTLIBRARIES)
	rm -rf  *.log *.o *.a

clean-config:
	rm -rf $(MAKEFILE_CONFS)

test: test.o

test.o: test/test.cc libgtest.a $(TESTS) $(HEADERS) $(SOURCES)
	g++ $(CPPTESTFLAGS) -o test.o  test/test.cc libgtest.a $(TESTS) $(HEADERS) $(SOURCES)
	./test.o
	
libgtest.a:
	g++ -I${GTEST_DIR}/include -I${GTEST_DIR} -c ${GTEST_DIR}/src/gtest-all.cc
	ar -rv libgtest.a gtest-all.o 
   	
.PHONY : test clean