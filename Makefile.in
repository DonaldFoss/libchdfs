LIBHADOP_DIR = ..
GTEST_DIR = /usr/local/src/gtest-1.6.0

CXX = g++
CXXFLAGS += 
CXXTESTFLAGS += -I${GTEST_DIR}/include -pthread

LIBGTEST = libgtest.a
LTLIBRARIES = libhadoop.so
MAKEFILE_CONFS = configure config.status config.log autom4te.cache/ Makefile

CONF_CLASS = conf/Configuration

OBJECTS = src/$(CONF_CLASS).o
SOURCES = $(OBJECTS:.o=.cc)
HEADERS = $(OBJECTS:.o=.h)

TESTS = test/$(CONF_CLASS)Test.cc



all: $(LTLIBRARIES)

$(LTLIBRARIES):  $(OBJECTS)
	$(CXX) $(CXXFLAGS) -shared -o $@ $<

clean:
	rm -rf  *.log *.a *.so
	find . -name "*.o" | xargs rm -rf
	find . -name "*.gch" | xargs rm -rf

test: test.o
	./test.o

test.o: test/test.cc $(LIBGTEST) $(TESTS) $(OBJECTS)
	$(CXX) $(CXXFLAGS) $(CXXTESTFLAGS) -o $@ test/test.cc $(LIBGTEST) $(TESTS) $(OBJECTS)
	
$(LIBGTEST):
	$(CXX) -I${GTEST_DIR}/include -I${GTEST_DIR} -c ${GTEST_DIR}/src/gtest-all.cc
	ar -rv  $@ gtest-all.o 
	
reMakefile: cleanMakefile
	autoconf
	./configure

cleanMakefile:
	rm -rf $(MAKEFILE_CONFS)
   	
.PHONY : all test clean reMakefile cleanMakefile